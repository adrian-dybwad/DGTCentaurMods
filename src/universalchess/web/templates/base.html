<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta name="description" content="Universal Chess - Connect, play, and analyze chess on your smart chess board">
    <meta name="theme-color" content="#aa44aa">
    
    <!-- PWA Support -->
    <link rel="manifest" href="{{ url_for('static', filename='manifest.json') }}">
    <link rel="apple-touch-icon" href="{{ url_for('static', filename='icons/icon.svg') }}">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="default">
    
    <title>Universal Chess</title>
    
    <!-- Stylesheets -->
    <link rel="stylesheet" href="{{ url_for('static', filename='chessboardjs/css/chessboard-1.0.0.css') }}">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bulma@0.9.3/css/bulma.min.css">
    <link rel="stylesheet" href="{{ url_for('static', filename='css/app.css') }}">
    
    <!-- Favicon -->
    <link rel="icon" type="image/svg+xml" href="{{ url_for('static', filename='icons/icon.svg') }}">
  </head>
  <body>
  <!--
    This file is part of the Universal Chess open source software
    https://github.com/adrian-dybwad/Universal-Chess
    
    Based on DGTCentaur Mods (https://github.com/EdNekebno/DGTCentaur)
    
    Universal Chess is free software: you can redistribute
    it and/or modify it under the terms of the GNU General Public
    License as published by the Free Software Foundation, either
    version 3 of the License, or (at your option) any later version.
    
    Universal Chess is distributed in the hope that it will
    be useful, but WITHOUT ANY WARRANTY; without even the implied warranty
    of MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the
    GNU General Public License for more details.
    
    You should have received a copy of the GNU General Public License
    along with this file. If not, see https://www.gnu.org/licenses/
    
    This and any other notices must remain intact and unaltered in any
    distribution, modification, variant, or derivative of this software.
  -->
  
  <nav class="navbar" role="navigation" aria-label="main navigation">
    <div class="navbar-brand">
      <a class="navbar-item" href="/" style="padding: 0.5rem 1rem;">
        <img src="/logo" alt="" style="max-height: 40px; margin-right: 0.75rem; border-radius: 4px;">
        <div class="brand-text">
          <span class="brand-title">Universal Chess</span>
          <span class="brand-tagline">Your smart chess companion</span>
        </div>
      </a>
      <a role="button" class="navbar-burger" aria-label="menu" aria-expanded="false" data-target="navbarMain">
        <span aria-hidden="true"></span>
        <span aria-hidden="true"></span>
        <span aria-hidden="true"></span>
      </a>
    </div>
    <div id="navbarMain" class="navbar-menu">
      <div class="navbar-start">
        <a class="navbar-item" href="/">Live Board</a>
        <a class="navbar-item" href="/pgn">Games</a>
        <a class="navbar-item" href="/configure">Settings</a>
        {% if rodentiv_installed %}
        <a class="navbar-item" href="/rodentivtuner">Rodent IV</a>
        {% endif %}
      </div>
      <div class="navbar-end">
        <a class="navbar-item" href="/support">Support</a>
        <a class="navbar-item" href="/license">Licenses</a>
        <div class="navbar-item">
          <span class="tag is-success" id="connection-status">
            <span class="status-dot connected"></span> Connected
          </span>
        </div>
      </div>
    </div>
  </nav>

  <section class="section">
    <div class="container">
      {% block mainpage %}{% endblock %}
    </div>
  </section>
  
  <footer class="footer">
    <div class="content has-text-centered">
      <p>
        <strong>Universal Chess</strong> &mdash; Open source software for smart chess boards
        <br>
        <a href="https://github.com/adrian-dybwad/Universal-Chess" target="_blank" rel="noopener">GitHub</a>
        &bull;
        <a href="/license">License</a>
        &bull;
        <a href="/support">Support</a>
      </p>
    </div>
  </footer>
  
  <!-- PWA Install Prompt -->
  <div class="pwa-install-prompt" id="pwaInstallPrompt">
    <span>Install Universal Chess for quick access</span>
    <button class="button is-primary is-small" id="pwaInstallBtn">Install</button>
    <button class="button is-light is-small" id="pwaInstallDismiss">Not now</button>
  </div>
  
  <script>
    // Mobile navbar toggle
    document.addEventListener('DOMContentLoaded', () => {
      const $navbarBurgers = Array.prototype.slice.call(document.querySelectorAll('.navbar-burger'), 0);
      $navbarBurgers.forEach(el => {
        el.addEventListener('click', () => {
          const target = el.dataset.target;
          const $target = document.getElementById(target);
          el.classList.toggle('is-active');
          $target.classList.toggle('is-active');
        });
      });
    });
    
    // Connection status monitoring
    function checkConnection() {
      var status = document.getElementById('connection-status');
      if (!status) return;
      
      fetch('/fen', { method: 'GET', cache: 'no-cache' })
        .then(function(response) {
          if (response.ok) {
            status.className = 'tag is-success';
            status.innerHTML = '<span class="status-dot connected"></span> Connected';
          } else {
            status.className = 'tag is-warning';
            status.innerHTML = '<span class="status-dot pending"></span> Reconnecting';
          }
        })
        .catch(function() {
          status.className = 'tag is-danger';
          status.innerHTML = '<span class="status-dot disconnected"></span> Offline';
        });
    }
    setInterval(checkConnection, 10000);
    
    // PWA Install
    let deferredPrompt;
    const pwaPrompt = document.getElementById('pwaInstallPrompt');
    const pwaInstallBtn = document.getElementById('pwaInstallBtn');
    const pwaDismissBtn = document.getElementById('pwaInstallDismiss');
    
    if (pwaPrompt && pwaInstallBtn && pwaDismissBtn) {
      window.addEventListener('beforeinstallprompt', (e) => {
        e.preventDefault();
        deferredPrompt = e;
        pwaPrompt.classList.add('show');
      });
      
      pwaInstallBtn.addEventListener('click', async () => {
        if (deferredPrompt) {
          deferredPrompt.prompt();
          await deferredPrompt.userChoice;
          deferredPrompt = null;
          pwaPrompt.classList.remove('show');
        }
      });
      
      pwaDismissBtn.addEventListener('click', () => {
        pwaPrompt.classList.remove('show');
      });
    }
    
    // Service Worker Registration
    if ('serviceWorker' in navigator) {
      window.addEventListener('load', () => {
        navigator.serviceWorker.register('/static/sw.js')
          .then(reg => console.log('Service Worker registered'))
          .catch(err => console.log('SW registration failed:', err));
      });
    }
  </script>

  </body>
</html>
