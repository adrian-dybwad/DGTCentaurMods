{#
  Analysis Component - Shared analysis widget with chart, eval bar, navigation, and best move display.
  
  Usage:
    {% include 'analysis_component.html' %}
  
  Required: Include Chart.js and chess.js before this component.
  
  Configuration (set before including):
    - analysisMode: 'live' (SSE updates, toast on new moves) or 'static' (game review)
    - analysisContainerId: optional custom container ID prefix (default: 'analysis')
  
  Events emitted:
    - analysisPositionChange: { fen, moveNumber } when position changes via navigation
  
  Events listened:
    - gameStateUpdate: { fen, pgn, move_number, ... } for live mode updates
#}

<div class="analysis-widget" id="{{ analysisContainerId | default('analysis') }}-widget">
  <!-- Eval display and best move -->
  <div class="analysis-eval-display" id="{{ analysisContainerId | default('analysis') }}-eval-display">
    <div style="display: flex; justify-content: space-between; align-items: center; padding: 0.5rem 0;">
      <span id="{{ analysisContainerId | default('analysis') }}-eval-score" style="font-size: 1.5rem; font-weight: bold;">0.0</span>
      <span id="{{ analysisContainerId | default('analysis') }}-best-move">Analyzing...</span>
    </div>
  </div>
  
  <!-- Eval bar -->
  <progress id="{{ analysisContainerId | default('analysis') }}-eval-bar" 
            class="progress is-warning" 
            value="50" max="100" 
            style="height: 0.5rem; margin-bottom: 0.5rem;">50%</progress>
  
  <!-- Chart -->
  <div style="height: 120px; margin-bottom: 0.5rem;">
    <canvas id="{{ analysisContainerId | default('analysis') }}-chart"></canvas>
  </div>
  
  <!-- Navigation buttons -->
  <div class="analysis-nav" id="{{ analysisContainerId | default('analysis') }}-nav" style="display: flex; gap: 0.25rem; justify-content: center; margin-bottom: 0.5rem;">
    <button class="button is-small" onclick="analysisNav.first()" title="First move">&lt;&lt;</button>
    <button class="button is-small" onclick="analysisNav.prev()" title="Previous move">&lt;</button>
    <span id="{{ analysisContainerId | default('analysis') }}-move-indicator" style="padding: 0.25rem 0.5rem; min-width: 60px; text-align: center;">0/0</span>
    <button class="button is-small" onclick="analysisNav.next()" title="Next move">&gt;</button>
    <button class="button is-small" onclick="analysisNav.last()" title="Last move">&gt;&gt;</button>
  </div>
  
  <!-- New moves toast (hidden by default, shown in live mode) -->
  <div id="{{ analysisContainerId | default('analysis') }}-new-moves-toast" 
       class="notification is-info is-light" 
       style="display: none; padding: 0.5rem 1rem; margin-top: 0.5rem; cursor: pointer;"
       onclick="analysisNav.jumpToLatest()">
    <span id="{{ analysisContainerId | default('analysis') }}-new-moves-count">0</span> new move(s) - Click to view
  </div>
</div>

<style>
  .analysis-widget {
    background: var(--color-bg-secondary, #f5f5f5);
    border-radius: 0.5rem;
    padding: 0.75rem;
  }
  
  .analysis-nav button {
    min-width: 2.5rem;
  }
  
  .analysis-nav button:hover {
    background: var(--color-accent-primary, #aa44aa);
    color: white;
  }
</style>

