{% extends "base.html" %}

{% block mainpage %}

<div style="width:100%">
    <div class="level">
        <div class="level-left">
            <h2 class="title" style="color: var(--color-accent-primary);">Game History</h2>
        </div>
        <div class="level-right">
            <div class="buttons">
                <button class="button is-small" id="prevPage" onclick="prevPage()" disabled>Previous</button>
                <span id="pageIndicator" style="padding: 0 1rem; color: var(--color-text-secondary);">Page 1</span>
                <button class="button is-small" id="nextPage" onclick="nextPage()">Next</button>
            </div>
        </div>
    </div>
    
    <div id="gameslisting">
        <div class="has-text-centered" style="padding: 3rem;">
            <p style="color: var(--color-text-muted);">Loading games...</p>
        </div>
    </div>
</div>

<script>
    var page = 1;
    var totalGames = 0;
    
    function showPGN(gameid) {
        var pgnDiv = document.getElementById("gamepgn-" + gameid);
        if (pgnDiv.innerHTML.trim() !== '') {
            // Toggle visibility
            pgnDiv.style.display = pgnDiv.style.display === 'none' ? 'block' : 'none';
            return;
        }
        
        pgnDiv.innerHTML = '<span style="color: var(--color-text-muted);">Loading...</span>';
        
        var xmlhttp = new XMLHttpRequest();
        xmlhttp.onreadystatechange = function() {
            if (xmlhttp.readyState == 4 && xmlhttp.status == 200) {
                var pre = document.createElement('pre');
                pre.style.cssText = 'background: var(--color-bg-primary); padding: 1rem; border-radius: 0.5rem; overflow-x: auto; font-family: var(--font-family-mono); font-size: 0.85rem; max-height: 300px; overflow-y: auto; white-space: pre-wrap; word-wrap: break-word;';
                pre.textContent = xmlhttp.responseText;
                pgnDiv.innerHTML = '';
                pgnDiv.appendChild(pre);
            }
        };
        xmlhttp.open("GET", "/getpgn/" + gameid, true);
        xmlhttp.send();
    }
    
    function prevPage() {
        if (page > 1) {
            page--;
            getGamesPGNList();
            updatePageControls();
        }
    }
    
    function nextPage() {
        page++;
        getGamesPGNList();
        updatePageControls();
    }
    
    function updatePageControls() {
        document.getElementById('pageIndicator').textContent = 'Page ' + page;
        document.getElementById('prevPage').disabled = page <= 1;
    }

    window.onload = function () {
        hideLastPGN();
        showLastGames();
        getGamesPGNList();
    }
</script>

{% endblock %}
